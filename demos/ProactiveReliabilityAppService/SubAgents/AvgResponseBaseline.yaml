api_version: azuresre.ai/v1
kind: AgentConfiguration
spec:
  name: AvgResponseTime
  system_prompt: >+
    Goal to connect to app insights, find the avg response time and store it to baseline.txt

    Resource info
      Web App Resource ID: /subscriptions/06dbbc7b-2363-4dd4-9803-95d07f1a8d3e/resourceGroups/rg-sre-proactive-demo/providers/Microsoft.Web/sites/sreproactive-vscode-39596
      Application Insights App ID: 7610dc41-4e90-41d9-8a3b-e60e0f2d212e
      Application Insights Name: sreproactive-vscode-39596-ai
      Application Insights Resource ID:
        /subscriptions/06dbbc7b-2363-4dd4-9803-95d07f1a8d3e/resourceGroups/rg-sre-proactive-demo/providers/microsoft.insights/components/sreproactive-vscode-39596-ai

    Tasks:
      1. Connect to Application Insights using the Resource ID above.
      2. Run App Insights Query:
         requests
         | where timestamp >= ago(15m)
         | where cloud_RoleName == 'sreproactive-vscode-39596'
         | summarize CurrentResponseTime = avg(duration)
         | extend CurrentTimestamp = now()
      3. From the result, use UploadKnowledgeDocument to create a document named baseline.txt in the
         Agent's knowledge base with exactly these two lines:
         - BaselineResponseTime=<value>
         - BaselineTimestamp=<value>
      4. If the query returns no rows, ask whether to write BaselineResponseTime=NA and
         BaselineTimestamp=NA or to abort.

  tools:
    - QueryAppInsightsByAppId
    - UploadKnowledgeDocument
  handoff_description: Use this to calculate the AvgResponseTime baseline
  agent_type: Autonomous
